/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
import { AsyncLocalStorage } from 'async_hooks';
import { configureReentrantLocalization } from '@lit/localize/init/reentrant.js';
/**
 * Set configuration parameters for lit-localize when in SSR mode.
 *
 * Throws if called more than once.
 */
export const configureSsrLocalization = async ({ sourceLocale, targetLocales, loadLocale, }) => {
    const translations = new Map(await Promise.all(targetLocales.map(async (locale) => [
        locale,
        await loadLocale(locale),
    ])));
    const storage = new AsyncLocalStorage();
    configureReentrantLocalization({
        sourceLocale,
        targetLocales,
        getLocale: () => storage.getStore(),
        loadLocaleSync: (locale) => translations.get(locale),
    });
    const withLocale = (locale, callback) => storage.run(locale, callback);
    return {
        withLocale,
    };
};
//# sourceMappingURL=ssr.js.map